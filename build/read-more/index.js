(()=>{"use strict";var e,r={102:(e,r,t)=>{const s=window.wp.blocks,a=window.wp.i18n,o=window.wp.element,d=window.wp.blockEditor,n=window.wp.components,i=window.wp.data,l=window.wp.coreData,c=window.wp.apiFetch;var m=t.n(c);const p=window.wp.primitives,h=window.ReactJSXRuntime,u=(0,h.jsx)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,h.jsx)(p.Path,{d:"M14.6 7l-1.2-1L8 12l5.4 6 1.2-1-4.6-5z"})}),g=(0,h.jsx)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,h.jsx)(p.Path,{d:"M10.6 6L9.4 7l4.6 5-4.6 5 1.2 1 5.4-6z"})}),_=JSON.parse('{"UU":"dmg/read-more"}');(0,s.registerBlockType)(_.UU,{edit:function({attributes:e,setAttributes:r}){const{postId:t,postTitle:s,postUrl:c}=e,[p,_]=(0,o.useState)(""),[x,w]=(0,o.useState)(""),[v,j]=(0,o.useState)([]),[f,b]=(0,o.useState)(!1),[y,k]=(0,o.useState)(1),[S,P]=(0,o.useState)(1),[T,C]=(0,o.useState)(""),I=(0,i.useSelect)((e=>e(l.store).getEntityRecords("postType","post",{per_page:5,_fields:"id,title,date,link",status:"publish",orderby:"date",order:"desc"})),[]);(0,o.useEffect)((()=>{!I||p||x||(j(I),P(1),C(""))}),[I]),(0,o.useEffect)((()=>{!t||s&&c||(b(!0),m()({path:`/wp/v2/posts/${t}?_fields=id,title,link`}).then((e=>{r({postTitle:e.title.rendered,postUrl:e.link}),b(!1),C("")})).catch((e=>{r({postId:0,postTitle:"",postUrl:""}),b(!1),C((0,a.__)("Error loading post data. The post may have been deleted.","dmg-read-more")),console.error("API Error:",e)})))}),[t,s,c]);const O=()=>{if(b(!0),C(""),x)return void m()({path:`/wp/v2/posts/${x}?_fields=id,title,date,link`}).then((e=>{j([e]),P(1),b(!1)})).catch((e=>{j([]),P(0),b(!1),C((0,a.__)("Post not found. Please check the ID and try again.","dmg-read-more")),console.error("API Error:",e)}));const e=new URLSearchParams({search:p,page:y.toString(),per_page:5..toString(),status:"publish",_fields:"id,title,date,link"});m()({path:`/wp/v2/posts?${e.toString()}`,parse:!1}).then((e=>{const r=parseInt(e.headers.get("X-WP-TotalPages")||1,10);return e.json().then((e=>{j(e),P(r),b(!1),0===e.length&&C((0,a.__)("No posts found matching your search criteria.","dmg-read-more"))}))})).catch((e=>{j([]),P(0),b(!1),C((0,a.__)("Error searching posts. Please try again later.","dmg-read-more")),console.error("API Error:",e)}))},B=e=>{r({postId:e.id,postTitle:e.title.rendered,postUrl:e.link}),C("")};(0,o.useEffect)((()=>{(p||x)&&O()}),[y]);const E=(0,d.useBlockProps)({className:"dmg-read-more"});return(0,h.jsxs)(h.Fragment,{children:[" ",(0,h.jsx)(d.InspectorControls,{children:(0,h.jsxs)(n.PanelBody,{title:(0,a.__)("Select Post","dmg-read-more"),children:[(0,h.jsx)(n.SearchControl,{label:(0,a.__)("Search posts","dmg-read-more"),value:p,onChange:e=>{_(e),w(""),k(1),C("")}}),(0,h.jsx)(n.TextControl,{label:(0,a.__)("Or search by Post ID","dmg-read-more"),value:x,onChange:e=>{w(e),_(""),k(1),C("")},type:"number"}),(0,h.jsx)(n.Button,{variant:"primary",onClick:O,disabled:!p&&!x||f,className:"dmg-read-more-search-button","aria-busy":f,children:(0,a.__)("Search","dmg-read-more")}),T&&(0,h.jsx)(n.Notice,{status:"error",isDismissible:!1,children:T}),(0,h.jsx)("div",{className:"dmg-read-more-results-container",children:(0,h.jsxs)(n.Card,{children:[(0,h.jsx)(n.CardHeader,{size:"small",children:(0,h.jsx)(n.__experimentalHeading,{level:3,children:p||x?(0,a.__)("Search Results","dmg-read-more"):(0,a.__)("Recent Posts","dmg-read-more")})}),(0,h.jsx)(n.CardBody,{size:"small",children:f?(0,h.jsx)(n.Spinner,{}):v&&0!==v.length?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{className:"dmg-read-more-search-results",role:"listbox","aria-label":(0,a.__)("Posts list","dmg-read-more"),children:v.map((e=>(0,h.jsx)(n.Card,{className:"dmg-read-more-search-result",onClick:()=>B(e),onKeyDown:r=>{"Enter"!==r.key&&" "!==r.key||(r.preventDefault(),B(e))},tabIndex:"0",role:"option","aria-selected":e.id===t,isBorderless:e.id!==t,size:"small",isRounded:!0,children:(0,h.jsxs)(n.CardBody,{children:[(0,h.jsx)(n.__experimentalHeading,{level:4,children:(0,h.jsx)("span",{dangerouslySetInnerHTML:{__html:e.title.rendered}})}),(0,h.jsx)(n.__experimentalText,{variant:"muted",children:new Date(e.date).toLocaleDateString()})]})},e.id)))}),S>1&&(0,h.jsxs)("div",{className:"dmg-read-more-pagination",children:[(0,h.jsx)(n.Button,{variant:"secondary",onClick:()=>k(Math.max(1,y-1)),disabled:1===y,icon:u,label:(0,a.__)("Previous page","dmg-read-more"),showTooltip:!0}),(0,h.jsx)(n.__experimentalText,{variant:"muted",children:(0,a.sprintf)(/* translators: 1: Current page number. 2: Total number of pages. */ /* translators: 1: Current page number. 2: Total number of pages. */
(0,a.__)("%1$s of %2$s","dmg-read-more"),y,S)}),(0,h.jsx)(n.Button,{variant:"secondary",onClick:()=>k(Math.min(S,y+1)),disabled:y===S,icon:g,label:(0,a.__)("Next page","dmg-read-more"),showTooltip:!0})]})]}):(0,h.jsx)("p",{children:(0,a.__)("No posts found.","dmg-read-more")})})]})})]})}),t?(0,h.jsxs)("p",{...E,children:[(0,a.__)("Read more:","dmg-read-more")," ",(0,h.jsx)("a",{href:c,children:s})]}):(0,h.jsx)(n.Placeholder,{label:(0,a.__)("DMG Read More","dmg-read-more"),instructions:(0,a.__)("Select a post from the sidebar to create a stylised link.","dmg-read-more"),icon:"admin-links"})]})},save:function({attributes:e}){const{postId:r,postTitle:t,postUrl:s}=e;if(!r||!t||!s)return null;const o=d.useBlockProps.save({className:"dmg-read-more"});return(0,h.jsxs)("p",{...o,children:[(0,a.__)("Read more:","dmg-read-more")," ",(0,h.jsx)("a",{href:s,children:t})]})}})}},t={};function s(e){var a=t[e];if(void 0!==a)return a.exports;var o=t[e]={exports:{}};return r[e](o,o.exports,s),o.exports}s.m=r,e=[],s.O=(r,t,a,o)=>{if(!t){var d=1/0;for(c=0;c<e.length;c++){for(var[t,a,o]=e[c],n=!0,i=0;i<t.length;i++)(!1&o||d>=o)&&Object.keys(s.O).every((e=>s.O[e](t[i])))?t.splice(i--,1):(n=!1,o<d&&(d=o));if(n){e.splice(c--,1);var l=a();void 0!==l&&(r=l)}}return r}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[t,a,o]},s.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return s.d(r,{a:r}),r},s.d=(e,r)=>{for(var t in r)s.o(r,t)&&!s.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},s.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),(()=>{var e={202:0,526:0};s.O.j=r=>0===e[r];var r=(r,t)=>{var a,o,[d,n,i]=t,l=0;if(d.some((r=>0!==e[r]))){for(a in n)s.o(n,a)&&(s.m[a]=n[a]);if(i)var c=i(s)}for(r&&r(t);l<d.length;l++)o=d[l],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(c)},t=globalThis.webpackChunkread_more=globalThis.webpackChunkread_more||[];t.forEach(r.bind(null,0)),t.push=r.bind(null,t.push.bind(t))})();var a=s.O(void 0,[526],(()=>s(102)));a=s.O(a)})();